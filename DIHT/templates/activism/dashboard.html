{% extends "base.html" %}
{% load static from staticfiles %}
{% block title %} Сайт общежития №2 (ФИВТ) - Биржа {% endblock %}
{% block main_active %} class = "active" {% endblock %}
{% block custom_scripts %}
	<link rel="stylesheet" href="{% static 'css/activism.css' %}">
{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Биржа</h1>
</div>
<div class = "row">
	<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        {% for task in tasks %}
        {% if task.is_urgent%}
		<div class="panel panel-danger">
        {% elif task.is_hard%}
        <div class="panel panel-warning">
        {% endif %}
			<div class="panel-heading dash-panel" role="tab" id="heading{{task.pk}}" data-toggle="collapse" data-parent="#accordion" href="#body{{task.pk}}" aria-expanded="false" aria-controls="body{{task.pk}}">
				<h4>{{ task.name }}</h4>
			</div>
			<div id="body{{task.pk}}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{{task.id}}">
				<div class="panel-body">
                    {% if task.event %}
					<a href="{% url 'activism:event' pk=task.event.pk %}">{{ task.event.name }}</a>/
                    {% endif %}
                    <a href="{% url 'activism:task' pk=task.pk %}">{{ task.name }}</a> <br>
					{{ task.description }} <br>
                    {% for tag in task.tags.all %}
					<a href="#">#{{tag}}</a>
                    {% endfor %}
                    <br>
					<span class = "param">Волонтерские Часы:</span> <span class="value-accent">{{ task.hours_predict }}</span><br>
					<span class = "param">Сделать до:</span> <span class="date-accent">{{ task.datetime_limit }}</span>
                    {% if request.user in task.candidates.all %}
                    <a class="btn btn-primary pull-right disabled" href="{% url 'activism:task' pk=task.pk %}">Заявка подана</a>
                    {% elif request.user in task.assignees.all %}
                    <a class="btn btn-primary pull-right disabled" href="{% url 'activism:task' pk=task.pk %}">Заявка одобрена</a>
                    {% else %}
                    <a class="btn btn-primary pull-right" href="{% url 'activism:do_task' pk=task.pk %}">Хочу выполнить!</a>
                    {% endif %}
					<br>
					<span class = "param">Активисты:</span>
                    <span class="value-accent">{{task.number_of_assignees}}</span>
                    <span class = "param">(набрано <span class="value-accent">{{task.assignees.all.count}}</span>)</span>
				</div>
			</div>
		</div>
        {% endfor %}
	</div>
    <center><a class="btn btn-default green robotobold"
               href="{% url 'activism:create_task'%}"
               data-toggle="modal"
               data-target="#form-modal">
        <i class="fa fa-plus fa-lg" style="margin-right:20px"></i> Создать задачу <i class="fa fa-plus fa-lg" style="margin-left:20px"></i>
    </a></center>
</div>
{% include "modal.html" %}
{% endblock %}